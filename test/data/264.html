Handling bad DOCTYPE declarationsGroupsConversationsAll groups and messagesSend feedback to GoogleHelpSign inGroupsbeautifulsoupConversationsAboutPrivacy • TermsHandling bad DOCTYPE declarations 496 viewsSkip to first unread messageKent Johnsonunread,Oct 3, 2007, 8:05:42 PM10/3/07Reply to authorSign in to reply to authorForwardSign in to forwardDeleteLinkReport message as abuseSign in to report message as abuseShow original messageEither email addresses are anonymous for this group or you need the view member email addresses permission to view the original messageto beautifulsoupCurrently if the DOCTYPE declaration doesn't parse correctly,BeautifulSoup puts the entire document into a single NavigableString.The problem is in the exception handler for parse_declaration(), whichpasses the entire balance of the document to handle_data(). Here is aversion of parse_declaration() that attempts to skip just thedeclaration itself.Kent    def parse_declaration(self, i):        """Treat a bogus SGML declaration as raw data. Treat a CDATA        declaration as a CData object."""        j = None        if self.rawdata[i:i+9] == '<![CDATA[':             k = self.rawdata.find(']]>', i)             if k == -1:                 k = len(self.rawdata)             data = self.rawdata[i+9:k]             j = k+3             self._toStringSubclass(data, CData)        else:            try:                j = SGMLParser.parse_declaration(self, i)            except SGMLParseError:                # Could not parse the DOCTYPE declaration                # Try to just skip the actual declaration                match = re.search(r'<!DOCTYPE([^>]*?)>', self.rawdata,re.MULTILINE)                if match:                    toHandle = self.rawdata[i:match.end()]                else:                    toHandle = self.rawdata[i:]                self.handle_data(toHandle)                j = i + len(toHandle)        return jKent Johnsonunread,Oct 3, 2007, 9:06:02 PM10/3/07Reply to authorSign in to reply to authorForwardSign in to forwardDeleteLinkReport message as abuseSign in to report message as abuseShow original messageEither email addresses are anonymous for this group or you need the view member email addresses permission to view the original messageto beauti...@googlegroups.comKent Johnson wrote:> Currently if the DOCTYPE declaration doesn't parse correctly,> BeautifulSoup puts the entire document into a single NavigableString.PS Here is a test case. The DOCTYPE is missing a quote before the URL:     def test_bad_doctype(self):         data = '''<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">         <html xmlns="http://www.w3.org/1999/xhtml" xml:lang="en" lang="en">         <head><title>Autoblog</title></head></html>'''         soup = BeautifulSoup(data)         self.assertEquals('Autoblog', soup.title.string)Reply allReply to authorForward0 new messagesSearchClear searchClose searchGoogle appsMain menu